

# 项目起步

## 创建项目

```sh
npm init vue@latest
```

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121116009.png" alt="image-20230512111611936" style="zoom:80%;" />

## 目录创建

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121120692.png" alt="image-20230512112022648" style="zoom:80%;" />

## 版本管理

基于 create-vue 创建出来的项目默认没有初始化git仓库，需要我们手动初始化,执行命令并完成首次提交

```sh
git init
git add . 
git commit -m "init"
```

## 接口文档

> 在线文档：https://www.apifox.cn/apidoc/shared-c05cb8d7-e591-4d9c-aff8-11065a0ec1de/api-67132167

## 路径联想提示

在编写代码的过程中，一旦 输入 @/ , VSCode会立刻 联想出src下的所有子目录和文件, 统一文件路径访问不容易出错

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121410516.png" alt="image-20230512141050453" style="zoom:80%;" />

> 在项目的根目录下新增 jsconfig.json 文件，添加json格式的配置项，如下：

```json
{
  "compilerOptions": {
    "baseUrl": "./",
    "paths": {
      "@/*": [
        "src/*"
      ]
    }
  }
}
```

> 注意：上面的只是路径提示的功能，真正的路径转换是在vite.config.js中

```js
resolve: {
  // 实际的路径转换  @  -> src
  alias: {
    '@': fileURLToPath(new URL('./src', import.meta.url))
  }
},
```

## ElementPlus

官网：https://element-plus.gitee.io/zh-CN/guide/design.html

### 组件分类

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121412591.png" alt="image-20230512141241542" style="zoom:67%;" />

### 按需导入

[按需导入官网](https://element-plus.gitee.io/zh-CN/guide/quickstart.html#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5)

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121413077.png" alt="image-20230512141333027" style="zoom:67%;" />

```bash
npm i elementPlus
npm install -D unplugin-vue-components unplugin-auto-import
```

> vite.config.js：配置自动按需导入

```js
// 引入插件
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'

export default defineConfig({
  plugins: [
    // 配置插件
    AutoImport({
      resolvers: [ElementPlusResolver()],
    }),
    Components({
      resolvers: [ElementPlusResolver()],
    }),
  ]
})
```

> 测试组件，成功完成按需导入

```vue
<template>
  <el-button type="primary">i am button</el-button>
</template>
```

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305151429925.png" alt="image-20230515142954887" style="zoom:80%;" />

### 主题定制

> 主题定制：https://element-plus.gitee.io/zh-CN/guide/theming.html

小兔鲜主题色和elementPlus默认的主题色存在冲突，通过定制主题让elementPlus的主题色和小兔鲜项目保持一致

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121414062.png" alt="image-20230512141427997" style="zoom:67%;" />

#### 安装sass

> 基于vite的项目默认不支持css预处理器，需要开发者单独安装

```bash
npm i sass -D
```

#### 准备定制化的样式文件

> 根目录即可，创建：styles/element/index.scss

```javascript
/* 只需要重写你需要的即可 */
@forward 'element-plus/theme-chalk/src/common/var.scss' with (
  $colors: (
    'primary': (
      // 主色
      'base': #27ba9b,
    ),
    'success': (
      // 成功色
      'base': #1dc779,
    ),
    'warning': (
      // 警告色
      'base': #ffb302,
    ),
    'danger': (
      // 危险色
      'base': #e26237,
    ),
    'error': (
      // 错误色
      'base': #cf4444,
    ),
  )
)
```

> style/var.scss

```scss
$xtxColor: #27ba9b;
$helpColor: #e26237;
$sucColor: #1dc779;
$warnColor: #ffb302;
$priceColor: #cf4444;
```

#### 自动导入配置

> vite.config.js，就是下面的两个步骤

```javascript
import { fileURLToPath, URL } from 'node:url'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// elementPlus按需导入
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    vue(),
    // ...
    AutoImport({
      resolvers: [ElementPlusResolver()],
    }),
    Components({
      resolvers: [
        // 1. 配置elementPlus采用sass样式配色系统
        ElementPlusResolver({ importStyle: "sass" }),
      ],
    }),
  ],
  resolve: {
    // 实际的路径转换  @  -> src
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  },
  css: {
    preprocessorOptions: {
      scss: {
        // 2. 自动导入定制化样式文件进行样式覆盖
        additionalData: `
          @use "@/styles/element/index.scss" as *;
          @use "@/styles/var.scss" as *;
        `,
      }
    }
  }
})
```

使用el-button按钮组件进行验证，type=”primary ”时显示主色，如果颜色变成了小兔鲜的主色，即为成功

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121415137.png" alt="image-20230512141502091" style="zoom:80%;" />



## axios基础配置

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121416430.png" alt="image-20230512141603378" style="zoom:80%;" />

### 安装axios

```sh
npm i axios
```

### 基础配置

> 官方文档地址：https://axios-http.com/zh/docs/intro，基础配置通常包括：
>
> 1. 实例化 - baseURL + timeout
> 2. 拦截器 - 携带token 401拦截等
> 2. 路径：utils/http.js

```javascript
import axios from 'axios'

// 创建axios实例
const http = axios.create({
  baseURL: 'http://pcapi-xiaotuxian-front-devtest.itheima.net',
  timeout: 5000
})

// axios请求拦截器
instance.interceptors.request.use(config => {
  return config
}, e => Promise.reject(e))

// axios响应式拦截器
instance.interceptors.response.use(res => res.data, e => {
  return Promise.reject(e)
})

export default httpInstance
```

### 封装请求函数并测试

> apis/testAPI.js

```javascript
import httpInstance from "@/utils/http"

export function getCategory () {
  return httpInstance({
    url: 'home/category/head'
  })
}
```

> main.js中可以进行测试，因为他是入口函数

```js
// 测试接口函数
import { getCategory } from "@/apis/testAPI";
getCategory().then(res => {
    console.log(res)
})
```

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305151446952.png" alt="image-20230515144652889" style="zoom:80%;" />

## 项目路由设计

### 一级路由

> 路由设计原则：**找页面的切换方式，如果是整体切换，则为一级路由**

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121417831.png" alt="image-20230512141702742" style="zoom:80%;" />

#### 文件夹创建

> views/Login/index.vue
>
> views/layout/index.vue

```html
<template>
  我是登录页
</template>
```

```html
<template>
  我是首页
</template>
```

#### 路由配置

> router/index.js

```javascript
// createRouter：创建router实例对象
// createWebHistory：创建history模式的路由
import { createRouter, createWebHistory } from 'vue-router'
// 引入路由组件，名称要写全，即包括后缀，不然无法识别
import Login from '@/views/Login/index.vue'
import Layout from '@/views/Layout/index.vue'
// 配置路由
const router = createRouter({
  // histry模式路由
  history: createWebHistory(import.meta.env.BASE_URL),
  // path和component对应关系的位置
  routes: [
    {
      path: '/',
      component: Layout,
    },
    {
      path: '/login',
      component: Login
    }
  ]
})
export default router
```

#### 路由出口

> App.vue

```vue
<template>
  <!-- 一级路由出口组件 -->
  <RouterView />
</template>
```

### 二级路由

> 路由设计原则：**找内容切换的区域，如果是在一级路由页的内部切换，则为二级路由**

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121417742.png" alt="image-20230512141753631" style="zoom:80%;" />

#### 文件夹创建

> views/Home/index.vue
>
> views/Category/index.vue

```html
<template>
  我是Home
</template>
```

```html
<template>
  我是Category
</template>
```

#### 路由配置

> router/index.js

```javascript
// createRouter：创建router实例对象
// createWebHistory：创建history模式的路由
import { createRouter, createWebHistory } from 'vue-router'
// 引入路由组件，名称要写全，即包括后缀，不然无法识别
import Login from '@/views/Login/index.vue'
import Layout from '@/views/Layout/index.vue'
// 二级路由
import Home from '@/views/Home/index.vue'
import Category from '@/views/Category/index.vue'

// 配置路由
const router = createRouter({
  // histry模式路由
  history: createWebHistory(import.meta.env.BASE_URL),
  // path和component对应关系的位置
  routes: [
    {
      path: '/',
      component: Layout,
      // 二级路由
      children: [
        {
          path: '', // 路由为空，表示访问父组件的/时，它也会被渲染
          component: Home
        },
        {
          path: 'category',
          component: Category
        }
      ]
    },
    {
      path: '/login',
      component: Login
    }
  ]
})
export default router
```

#### 路由出口

> views/Layout/index.vue

```vue
<template>
  我是首页
  <!-- 二级路由出口 -->
  <RouterView />
</template>
```

## 静态资源初始化

### 资源说明

> 1. **实际工作中的图片资源通常由 UI设计师 提供，常见的图片格式有png,svg等都是由UI切图交给前端**
>
> 2. **样式资源通常是指项目初始化的时候进行样式重置，常见的比如开源的 normalize.css 或者手写**

### 资源操作

> 1. 图片资源 - 把 images 文件夹放到 assets 目录下
>
> 2. 样式资源 - 把 common.scss 文件放到 styles 目录下，并在main.js中引入common.scss 

```js
// main.js引入初始化样式文件
import '@/styles/common.scss'
```

### error lens

> error lens是一个实时提供错误警告信息的VSCode插件，方便开发

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121419442.png" alt="image-20230512141909367" style="zoom:67%;" />

## scss自动导入

> 为什么要自动导入：在项目里一些组件共享的色值会以scss变量的方式统一放到一个名为 var.scss 的文件中，正常组件中使用，需要先导入scss文件，再使用内部的变量，比较繁琐，自动导入可以免去手动导入的步骤，直接使用内部的变量

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121419502.png" alt="image-20230512141949433" style="zoom:80%;" />

> styles/var.scss
>

```css
$xtxColor: #27ba9b;
$helpColor: #e26237;
$sucColor: #1dc779;
$warnColor: #ffb302;
$priceColor: #cf4444;
```

> vite.config.js，配置在主题配置那里

```json
css: {
    preprocessorOptions: {
      scss: {
        // 自动导入scss文件
        additionalData: `
          @use "@/styles/element/index.scss" as *;
          @use "@/styles/var.scss" as *;
        `,
      }
    }
}
```

# Layout

## 静态模版搭建

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121421804.png" alt="image-20230512142101735" style="zoom:80%;" />

### LayoutNav

> views/Layout/components/LayoutNav.vue

```scss
<script setup>

</script>

<template>
  <nav class="app-topnav">
    <div class="container">
      <ul>
        <template v-if="true">
          <li><a href="javascript:;""><i class="iconfont icon-user"></i>周杰伦</a></li>
          <li>
            <el-popconfirm title="确认退出吗?" confirm-button-text="确认" 
                                              cancel-button-text="取消">
              <template #reference>
                <a href="javascript:;">退出登录</a>
              </template>
            </el-popconfirm>
          </li>
          <li><a href="javascript:;">我的订单</a></li>
          <li><a href="javascript:;">会员中心</a></li>
        </template>
        <template v-else>
          <li><a href="javascript:;">请先登录</a></li>
          <li><a href="javascript:;">帮助中心</a></li>
          <li><a href="javascript:;">关于我们</a></li>
        </template>
      </ul>
    </div>
  </nav>
</template>


<style scoped lang="scss">
.app-topnav {
  background: #333;
  ul {
    display: flex;
    height: 53px;
    justify-content: flex-end;
    align-items: center;
    li {
      a {
        padding: 0 15px;
        color: #cdcdcd;
        line-height: 1;
        display: inline-block;

        i {
          font-size: 14px;
          margin-right: 2px;
        }

        &:hover {
          color: $xtxColor;
        }
      }
      ~li {
        a {
          border-left: 2px solid #666;
        }
      }
    }
  }
}
</style>
```

### LayoutHeader

> views/Layout/components/LayoutHeader.vue

```scss
<script setup>

</script>

<template>
  <header class='app-header'>
    <div class="container">
      <h1 class="logo">
        <RouterLink to="/">小兔鲜</RouterLink>
      </h1>
      <ul class="app-header-nav">
        <li class="home">
          <RouterLink to="/">首页</RouterLink>
        </li>
        <li> <RouterLink to="/">居家</RouterLink> </li>
        <li> <RouterLink to="/">美食</RouterLink> </li>
        <li> <RouterLink to="/">服饰</RouterLink> </li>
      </ul>
      <div class="search">
        <i class="iconfont icon-search"></i>
        <input type="text" placeholder="搜一搜">
      </div>
      <!-- 头部购物车 -->
    </div>
  </header>
</template>


<style scoped lang='scss'>
.app-header {
  background: #fff;

  .container {
    display: flex;
    align-items: center;
  }

  .logo {
    width: 200px;

    a {
      display: block;
      height: 132px;
      width: 100%;
      text-indent: -9999px;
      background: url('@/assets/images/logo.png') no-repeat center 18px / contain;
    }
  }

  .app-header-nav {
    width: 820px;
    display: flex;
    padding-left: 40px;
    position: relative;
    z-index: 998;
  
    li {
      margin-right: 40px;
      width: 38px;
      text-align: center;
  
      a {
        font-size: 16px;
        line-height: 32px;
        height: 32px;
        display: inline-block;
  
        &:hover {
          color: $xtxColor;
          border-bottom: 1px solid $xtxColor;
        }
      }
  
      .active {
        color: $xtxColor;
        border-bottom: 1px solid $xtxColor;
      }
    }
  }

  .search {
    width: 170px;
    height: 32px;
    position: relative;
    border-bottom: 1px solid #e7e7e7;
    line-height: 32px;

    .icon-search {
      font-size: 18px;
      margin-left: 5px;
    }

    input {
      width: 140px;
      padding-left: 5px;
      color: #666;
    }
  }

  .cart {
    width: 50px;

    .curr {
      height: 32px;
      line-height: 32px;
      text-align: center;
      position: relative;
      display: block;

      .icon-cart {
        font-size: 22px;
      }

      em {
        font-style: normal;
        position: absolute;
        right: 0;
        top: 0;
        padding: 1px 6px;
        line-height: 1;
        background: $helpColor;
        color: #fff;
        font-size: 12px;
        border-radius: 10px;
        font-family: Arial;
      }
    }
  }
}
</style>
```

### LayoutHeader

> views/Layout/components/LayoutHeader.vue

```scss
<template>
  <footer class="app_footer">
    <!-- 联系我们 -->
    <div class="contact">
      <div class="container">
        <dl>
          <dt>客户服务</dt>
          <dd><i class="iconfont icon-kefu"></i> 在线客服</dd>
          <dd><i class="iconfont icon-question"></i> 问题反馈</dd>
        </dl>
        <dl>
          <dt>关注我们</dt>
          <dd><i class="iconfont icon-weixin"></i> 公众号</dd>
          <dd><i class="iconfont icon-weibo"></i> 微博</dd>
        </dl>
        <dl>
          <dt>下载APP</dt>
          <dd class="qrcode"><img src="@/assets/images/qrcode.jpg" /></dd>
          <dd class="download">
            <span>扫描二维码</span>
            <span>立马下载APP</span>
            <a href="javascript:;">下载页面</a>
          </dd>
        </dl>
        <dl>
          <dt>服务热线</dt>
          <dd class="hotline">400-0000-000 <small>周一至周日 8:00-18:00</small></dd>
        </dl>
      </div>
    </div>
    <!-- 其它 -->
    <div class="extra">
      <div class="container">
        <div class="slogan">
          <a href="javascript:;">
            <i class="iconfont icon-footer01"></i>
            <span>价格亲民</span>
          </a>
          <a href="javascript:;">
            <i class="iconfont icon-footer02"></i>
            <span>物流快捷</span>
          </a>
          <a href="javascript:;">
            <i class="iconfont icon-footer03"></i>
            <span>品质新鲜</span>
          </a>
        </div>
        <!-- 版权信息 -->
        <div class="copyright">
          <p>
            <a href="javascript:;">关于我们</a>
            <a href="javascript:;">帮助中心</a>
            <a href="javascript:;">售后服务</a>
            <a href="javascript:;">配送与验收</a>
            <a href="javascript:;">商务合作</a>
            <a href="javascript:;">搜索推荐</a>
            <a href="javascript:;">友情链接</a>
          </p>
          <p>CopyRight © 小兔鲜儿</p>
        </div>
      </div>
    </div>
  </footer>
</template>

<style scoped lang='scss'>
.app_footer {
  overflow: hidden;
  background-color: #f5f5f5;
  padding-top: 20px;

  .contact {
    background: #fff;

    .container {
      padding: 60px 0 40px 25px;
      display: flex;
    }

    dl {
      height: 190px;
      text-align: center;
      padding: 0 72px;
      border-right: 1px solid #f2f2f2;
      color: #999;

      &:first-child {
        padding-left: 0;
      }

      &:last-child {
        border-right: none;
        padding-right: 0;
      }
    }

    dt {
      line-height: 1;
      font-size: 18px;
    }

    dd {
      margin: 36px 12px 0 0;
      float: left;
      width: 92px;
      height: 92px;
      padding-top: 10px;
      border: 1px solid #ededed;

      .iconfont {
        font-size: 36px;
        display: block;
        color: #666;
      }

      &:hover {
        .iconfont {
          color: $xtxColor;
        }
      }

      &:last-child {
        margin-right: 0;
      }
    }

    .qrcode {
      width: 92px;
      height: 92px;
      padding: 7px;
      border: 1px solid #ededed;
    }

    .download {
      padding-top: 5px;
      font-size: 14px;
      width: auto;
      height: auto;
      border: none;

      span {
        display: block;
      }

      a {
        display: block;
        line-height: 1;
        padding: 10px 25px;
        margin-top: 5px;
        color: #fff;
        border-radius: 2px;
        background-color: $xtxColor;
      }
    }

    .hotline {
      padding-top: 20px;
      font-size: 22px;
      color: #666;
      width: auto;
      height: auto;
      border: none;

      small {
        display: block;
        font-size: 15px;
        color: #999;
      }
    }
  }

  .extra {
    background-color: #333;
  }

  .slogan {
    height: 178px;
    line-height: 58px;
    padding: 60px 100px;
    border-bottom: 1px solid #434343;
    display: flex;
    justify-content: space-between;

    a {
      height: 58px;
      line-height: 58px;
      color: #fff;
      font-size: 28px;

      i {
        font-size: 50px;
        vertical-align: middle;
        margin-right: 10px;
        font-weight: 100;
      }

      span {
        vertical-align: middle;
        text-shadow: 0 0 1px #333;
      }
    }
  }

  .copyright {
    height: 170px;
    padding-top: 40px;
    text-align: center;
    color: #999;
    font-size: 15px;

    p {
      line-height: 1;
      margin-bottom: 20px;
    }

    a {
      color: #999;
      line-height: 1;
      padding: 0 10px;
      border-right: 1px solid #999;

      &:last-child {
        border-right: none;
      }
    }
  }
}
</style>
```

### index

> views/Layout/index.vue

```vue
<script setup>
import LayoutNav from './components/LayoutNav.vue'
import LayoutHeader from './components/LayoutHeader.vue'
import LayoutFooter from './components/LayoutFooter.vue'
</script>

<template>
  <LayoutNav />
  <LayoutHeader />
  <RouterView />
  <LayoutFooter />
</template>
```

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305151518043.png" alt="image-20230515151851940" style="zoom:80%;" />

## 字体图标

https://www.iconfont.cn/

### 现存问题

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121421295.png" alt="image-20230512142145237" style="zoom:67%;" />

### 如何引入

> 小兔鲜里采用的是 font-class引用 的方式，下面地址包含用到的所有图标放到index.html里面

```css
<link rel="stylesheet" href="//at.alicdn.com/t/font_2143783_iq6z4ey5vu.css">
```

> 应用图标：挑选相应图标并获取类名，应用于页面

```css
<i class="iconfont icon-xxx"></i>
```

## 一级导航渲染 

### 功能描述

> 使用后端接口渲染渲染一级路由导航

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121422185.png" alt="image-20230512142235147" style="zoom:80%;" />

> 1. 根据接口文档封装接口函数
>
> 2. 发送请求获取数据列表
>
> 3. v-for渲染页面

### 发起请求

> apis/layout.js

```javascript
import httpInstance from "@/utils/http"

export function getCategoryAPI () {
  return httpInstance({
    url: '/home/category/head'
  })
}
```

### 数据渲染

> views/components/LayoutHeader.vue

```vue
<script setup>
  import { getCategoryAPI } from '@/apis/layout'
  import { onMounted, ref } from 'vue'
  // 获取数据
  const categoryList = ref([])
  const getCategory = async () => {
    const res = await getCategoryAPI()
    categoryList.value = res.result
  }
  // 立即启动
  onMounted(() => getCategory())
</script>

<template>
  <header class='app-header'>
    <div class="container">
      <h1 class="logo">
        <RouterLink to="/">小兔鲜</RouterLink>
      </h1>
      <!-- 这里进行数据渲染 -->
      <ul class="app-header-nav">
        <li class="home" v-for="item in categoryList" :key="item.id">
          <RouterLink to="/">{{ item.name }}</RouterLink>
        </li>
      </ul>
      <div class="search">
        <i class="iconfont icon-search"></i>
        <input type="text" placeholder="搜一搜">
        </div>
      <!-- 头部购物车 -->
    </div>
  </header>
</template>
```

## 吸顶导航交互

### 吸顶交互

> 要求：浏览器在上下滚动的过程中，如果距离顶部的滚动距离大于78px，吸顶导航显示，小于78px隐藏

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305151539829.png" alt="image-20230515153915676" style="zoom:80%;" />

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121423653.png" alt="image-20230512142321610" style="zoom:80%;" />



<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121423160.png" alt="image-20230512142337103" style="zoom:80%;" />

### 组件静态结构

> views/Layout/components/LayoutFixed.vue

```vue
<script setup>

</script>

<template>
  <div class="app-header-sticky">
    <div class="container">
      <RouterLink class="logo" to="/" />
      <!-- 导航区域 -->
      <ul class="app-header-nav ">
        <li class="home">
          <RouterLink to="/">首页</RouterLink>
        </li>
        <li>
          <RouterLink to="/">居家</RouterLink>
        </li>
        <li>
          <RouterLink to="/">美食</RouterLink>
        </li>
        <li>
          <RouterLink to="/">服饰</RouterLink>
        </li>
        <li>
          <RouterLink to="/">母婴</RouterLink>
        </li>
        <li>
          <RouterLink to="/">个护</RouterLink>
        </li>
        <li>
          <RouterLink to="/">严选</RouterLink>
        </li>
        <li>
          <RouterLink to="/">数码</RouterLink>
        </li>
        <li>
          <RouterLink to="/">运动</RouterLink>
        </li>
        <li>
          <RouterLink to="/">杂项</RouterLink>
        </li>
      </ul>

      <div class="right">
        <RouterLink to="/">品牌</RouterLink>
        <RouterLink to="/">专题</RouterLink>
      </div>
    </div>
  </div>
</template>


<style scoped lang='scss'>
.app-header-sticky {
  width: 100%;
  height: 80px;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 999;
  background-color: #fff;
  border-bottom: 1px solid #e4e4e4;
  // 此处为关键样式!!!
  // 状态一：往上平移自身高度 + 完全透明
  transform: translateY(-100%);
  opacity: 0;

  // 状态二：移除平移 + 完全不透明
  &.show {
    transition: all 0.3s linear;
    transform: none;
    opacity: 1;
  }

  .container {
    display: flex;
    align-items: center;
  }

  .logo {
    width: 200px;
    height: 80px;
    background: url("@/assets/images/logo.png") no-repeat right 2px;
    background-size: 160px auto;
  }

  .right {
    width: 220px;
    display: flex;
    text-align: center;
    padding-left: 40px;
    border-left: 2px solid $xtxColor;

    a {
      width: 38px;
      margin-right: 40px;
      font-size: 16px;
      line-height: 1;

      &:hover {
        color: $xtxColor;
      }
    }
  }
}

.app-header-nav {
  width: 820px;
  display: flex;
  padding-left: 40px;
  position: relative;
  z-index: 998;

  li {
    margin-right: 40px;
    width: 38px;
    text-align: center;

    a {
      font-size: 16px;
      line-height: 32px;
      height: 32px;
      display: inline-block;

      &:hover {
        color: $xtxColor;
        border-bottom: 1px solid $xtxColor;
      }
    }

    .active {
      color: $xtxColor;
      border-bottom: 1px solid $xtxColor;
    }
  }
}
</style>
```

> views/Layout/index.vue

```vue
<template>
  <!-- 引入LayoutFixed组件 -->
  <LayoutFixed />
  <LayoutNav />
  <LayoutHeader />
  <RouterView />
  <LayoutFooter />
</template>
```

### 实现吸顶交互

> vueuse的useScroll函数可以很好的解决问题
>
> 核心逻辑：根据滚动距离判断当前show类名是否显示，大于78显示，小于78，不显示

```sh
npm i @vueuse/core
```

> views/Layout/components/LayoutFixed.vue

```vue
<script setup>
// vueUse导入使用，y就是垂直滚动的实时距离
import { useScroll } from '@vueuse/core'
const { y } = useScroll(window)
</script>

<template>
  <!-- show就是定义的css类名，即是否显示该类名对应的样式 -->
  <div class="app-header-sticky" :class="{ show: y > 78 }">
    <!-- 省略部分代码 -->
  </div>
</template>
```



## 优化重复请求

### 为什么优化

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121424314.png" alt="image-20230512142408268" style="zoom:80%;" />

> 结论：吸顶导航和正常导航俩个导航中的列表是完全一致的，但是要发送俩次网络请求，存在浪费。通过Pinia集中管理数据，再把数据给组件使用

### LayoutFixed

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121424345.png" alt="image-20230512142445289" style="zoom:67%;" />

> views/Layout/components/LayoutFixed.vue

> 将LayoutFixed.vue的静态结构换成LayoutHeader.vue中的网络请求，会调用两次，因此需要优化

```vue
<script setup>
  // vueUse导入使用，y就是垂直滚动的实时距离
  import { useScroll } from '@vueuse/core'
  const { y } = useScroll(window)
  const { y } = useScroll(window)
  import { getCategoryAPI } from '@/apis/layout'
  import { onMounted, ref } from 'vue'
  // 获取数据
  const categoryList = ref([])
  const getCategory = async () => {
    const res = await getCategoryAPI()
    categoryList.value = res.result
  }
  // 立即启动
  onMounted(() => getCategory())
</script>

<template>
  <div class="app-header-sticky" :class="{ show: y > 78 }">
    <div class="container">
      <h1 class="logo"><RouterLink to="/">小兔鲜</RouterLink></h1>
      <!-- 这里进行数据渲染 -->
      <ul class="app-header-nav">
        <li class="home" v-for="item in categoryList" :key="item.id">
          <RouterLink to="/">{{ item.name }}</RouterLink>
        </li>
      </ul>
      <div class="search">
        <i class="iconfont icon-search"></i>
        <input type="text" placeholder="搜一搜">
        </div>
      <!-- 头部购物车 -->
    </div>
  </div>
</template>
<!-- scss省略 -->
```

### Pinia

> store/categoryStore.js

```js
import { ref } from 'vue'
import { defineStore } from 'pinia'
import { getCategoryAPI } from '@/apis/layout'
export const useCategoryStore = defineStore('category', () => {
  // 导航列表的数据管理
  // state 导航列表数据
  const categoryList = ref([])

  // action 获取导航数据的方法
  const getCategory = async () => {
    const res = await getCategoryAPI()
    categoryList.value = res.result
  }

  return {
    categoryList,
    getCategory
  }
})
```

### index

> views/Layout/index.vue

```vue
<script setup>

import LayoutNav from './components/LayoutNav.vue'
...
// 触发获取导航列表的action，重点是以下内容
import { useCategoryStore } from '@/stores/categoryStore'
import { onMounted } from 'vue'
const categoryStore = useCategoryStore()
onMounted(() => categoryStore.getCategory())
</script>
```

### LayoutFixed

> views/Layout/components/LayoutFixed.vue

```vue
<script setup>
// vueUse
import { useScroll } from '@vueuse/core'
import { useCategoryStore } from '@stores/category'
const { y } = useScroll(window)
// 使用pinia中的数据，只有先调用方法，return出的数据才能直接用
const categoryStore = useCategoryStore()
</script>
...
<li class="home" v-for="item in categoryStoreList" :key="item.id">
    <RouterLink to="/">{{ item.name }}</RouterLink>
</li>
```

### LayoutHeader

> views/Layout/components/HeaderFixed.vue

```vue
<script setup>
import { useCategoryStore } from '@stores/category'
// 使用pinia中的数据，只有先调用方法，return出的数据才能直接用
const categoryStore = useCategoryStore()
</script>
...
<li class="home" v-for="item in categoryStoreList" :key="item.id">
    <RouterLink to="/">{{ item.name }}</RouterLink>
</li>
```



# Home

## 页面结构

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121427214.png" alt="image-20230512142720157" style="zoom:67%;" />

按照结构新增五个组件，准备最简单的模版，分别在Home模块的入口组件中创建

- HomeCategory.vue
- HomeBanner.vue
- HomeNew.vue
- HomeHot.vue
- HomeProduct.vue

```vue
<script setup>
</script>

<template>
  <div> HomeCategory </div>
</template>
```

Home模块入口组件中引入并渲染

```vue
<script setup>
import HomeCategory from './components/HomeCategory.vue'
import HomeBanner from './components/HomeBanner.vue'
import HomeNew from './components/HomeNew.vue'
import HomeHot from './components/HomeHot.vue'
import homeProduct from './components/HomeProduct.vue'
</script>

<template>
  <div class="container">
      <HomeCategory/>
      <HomeBanner/>
  </div>
  <HomeNew/>
  <HomeHot/>
  <homeProduct/>
</template>
```

## 分类实现

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121427722.png" alt="image-20230512142736690" style="zoom:80%;" />

1- 准备详细模版

```vue
<script setup>

</script>

<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="item in 9" :key="item">
        <RouterLink to="/">居家</RouterLink>
        <RouterLink v-for="i in 2" :key="i" to="/">南北干货</RouterLink>
        <!-- 弹层layer位置 -->
        <div class="layer">
          <h4>分类推荐 <small>根据您的购买或浏览记录推荐</small></h4>
          <ul>
            <li v-for="i in 5" :key="i">
              <RouterLink to="/">
                <img alt="" />
                <div class="info">
                  <p class="name ellipsis-2">
                    男士外套
                  </p>
                  <p class="desc ellipsis">男士外套，冬季必选</p>
                  <p class="price"><i>¥</i>200.00</p>
                </div>
              </RouterLink>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </div>
</template>


<style scoped lang='scss'>
.home-category {
  width: 250px;
  height: 500px;
  background: rgba(0, 0, 0, 0.8);
  position: relative;
  z-index: 99;

  .menu {
    li {
      padding-left: 40px;
      height: 55px;
      line-height: 55px;

      &:hover {
        background: $xtxColor;
      }

      a {
        margin-right: 4px;
        color: #fff;

        &:first-child {
          font-size: 16px;
        }
      }

      .layer {
        width: 990px;
        height: 500px;
        background: rgba(255, 255, 255, 0.8);
        position: absolute;
        left: 250px;
        top: 0;
        display: none;
        padding: 0 15px;

        h4 {
          font-size: 20px;
          font-weight: normal;
          line-height: 80px;

          small {
            font-size: 16px;
            color: #666;
          }
        }

        ul {
          display: flex;
          flex-wrap: wrap;

          li {
            width: 310px;
            height: 120px;
            margin-right: 15px;
            margin-bottom: 15px;
            border: 1px solid #eee;
            border-radius: 4px;
            background: #fff;

            &:nth-child(3n) {
              margin-right: 0;
            }

            a {
              display: flex;
              width: 100%;
              height: 100%;
              align-items: center;
              padding: 10px;

              &:hover {
                background: #e3f9f4;
              }

              img {
                width: 95px;
                height: 95px;
              }

              .info {
                padding-left: 10px;
                line-height: 24px;
                overflow: hidden;

                .name {
                  font-size: 16px;
                  color: #666;
                }

                .desc {
                  color: #999;
                }

                .price {
                  font-size: 22px;
                  color: $priceColor;

                  i {
                    font-size: 16px;
                  }
                }
              }
            }
          }
        }
      }

      // 关键样式  hover状态下的layer盒子变成block
      &:hover {
        .layer {
          display: block;
        }
      }
    }
  }
}
</style>
```

2- 完成代码

```vue
<script setup>
import { useCategoryStore } from '@/stores/category'

const categoryStore = useCategoryStore()

</script>

<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="item in categoryStore.categoryList" :key="item.id">
        <RouterLink to="/">{{ item.name }}</RouterLink>
        <RouterLink v-for="i in item.children.slice(0, 2)" :key="i" to="/">{{ i.name }}</RouterLink>
        <!-- 弹层layer位置 -->
        <div class="layer">
          <h4>分类推荐 <small>根据您的购买或浏览记录推荐</small></h4>
          <ul>
            <li v-for="i in item.goods" :key="i.id">
              <RouterLink to="/">
                <img :src="i.picture" alt="" />
                <div class="info">
                  <p class="name ellipsis-2">
                    {{ i.name }}
                  </p>
                  <p class="desc ellipsis">{{ i.desc }}</p>
                  <p class="price"><i>¥</i>{{ i.price }}</p>
                </div>
              </RouterLink>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </div>
</template>
```

## 轮播图实现

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121428109.png" alt="image-20230512142817957" style="zoom:80%;" />

### 熟悉组件

```vue
<script setup>

</script>

<template>
  <div class="home-banner">
    <el-carousel height="500px">
      <el-carousel-item v-for="item in 4" :key="item">
        <img src="http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-04-15/6d202d8e-bb47-4f92-9523-f32ab65754f4.jpg" alt="">
      </el-carousel-item>
    </el-carousel>
  </div>
</template>



<style scoped lang='scss'>
.home-banner {
  width: 1240px;
  height: 500px;
  position: absolute;
  left: 0;
  top: 0;
  z-index: 98;

  img {
    width: 100%;
    height: 500px;
  }
}
</style>
```

### 获取数据渲染组件

1- 封装接口

```javascript
/**
 * @description: 获取banner图
 * @param {*}
 * @return {*}
 */
import  httpInstance  from '@/utils/http'
function getBannerAPI (){
  return request({
    url:'home/banner'
  })
}
```

2- 获取数据渲染模版

```vue
<script setup>
import { getBannerAPI } from '@/apis/home'
import { onMounted, ref } from 'vue'

const bannerList = ref([])

const getBanner = async () => {
  const res = await getBannerAPI()
  console.log(res)
  bannerList.value = res.result
}

onMounted(() => getBanner())

</script>

<template>
  <div class="home-banner">
    <el-carousel height="500px">
      <el-carousel-item v-for="item in bannerList" :key="item.id">
        <img :src="item.imgUrl" alt="">
      </el-carousel-item>
    </el-carousel>
  </div>
</template>

```



## 面板组件封装

### 场景说明

> 问：组件封装解决了什么问题？答：1. 复用问题 2. 业务维护问题

> 新鲜好物和人气推荐模块，在结构上非常相似，只是内容不同，通过组件封装可以实现复用结构的效果

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121428264.png" alt="image-20230512142847185" style="zoom:80%;" />

### 组件封装

> 核心思路：把可复用的结构只写一次，把可能发生变化的部分抽象成组件参数（props / 插槽）

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121429925.png" alt="image-20230512142912831" style="zoom:80%;" />

> 实现步骤
>
> 1. 不做任何抽象，准备静态模版
>
> 2. 抽象可变的部分 \- 主标题和副标题是纯文本，可以抽象成prop传入 \- 主体内容是复杂的模版，抽象成插槽传入

### 1. 纯静态结构

```vue
<script setup>

</script>


<template>
  <div class="home-panel">
    <div class="container">
      <div class="head">
         <!-- 主标题和副标题 -->
        <h3>
          新鲜好物<small>新鲜出炉 品质靠谱</small>
        </h3>
      </div>
      <!-- 主体内容区域 -->
      <div> 主体内容 </div>
    </div>
  </div>
</template>

<style scoped lang='scss'>
.home-panel {
  background-color: #fff;

  .head {
    padding: 40px 0;
    display: flex;
    align-items: flex-end;

    h3 {
      flex: 1;
      font-size: 32px;
      font-weight: normal;
      margin-left: 6px;
      height: 35px;
      line-height: 35px;

      small {
        font-size: 16px;
        color: #999;
        margin-left: 20px;
      }
    }
  }
}
</style>
```

### 2. 完整代码

```vue
<script setup>

defineProps({
  title: {
    type: String,
    default: ''
  },
  subTitle: {
    type: String,
    default: ''
  }
})

</script>


<template>
  <div class="home-panel">
    <div class="container">
      <div class="head">
        <!-- 主标题和副标题 -->
        <h3>
          {{ title }}<small>{{ subTitle }}</small>
        </h3>
      </div>
      <!-- 主体内容区域 -->
      <slot name="main" />
    </div>
  </div>
</template>


<style scoped lang='scss'>
.home-panel {
  background-color: #fff;

  .head {
    padding: 40px 0;
    display: flex;
    align-items: flex-end;

    h3 {
      flex: 1;
      font-size: 32px;
      font-weight: normal;
      margin-left: 6px;
      height: 35px;
      line-height: 35px;

      small {
        font-size: 16px;
        color: #999;
        margin-left: 20px;
      }
    }
  }
}
</style>
```





## 新鲜好物实现

### 新鲜好物实现

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121430028.png" alt="image-20230512143007948" style="zoom:67%;" />

### 1. 准备模版

```vue
<script setup>

</script>

<template>
  <div></div>
  <!-- 下面是插槽主体内容模版
  <ul class="goods-list">
    <li v-for="item in newList" :key="item.id">
      <RouterLink to="/">
        <img :src="item.picture" alt="" />
        <p class="name">{{ item.name }}</p>
        <p class="price">&yen;{{ item.price }}</p>
      </RouterLink>
    </li>
  </ul>
  -->
</template>


<style scoped lang='scss'>
.goods-list {
  display: flex;
  justify-content: space-between;
  height: 406px;

  li {
    width: 306px;
    height: 406px;

    background: #f0f9f4;
    transition: all .5s;

    &:hover {
      transform: translate3d(0, -3px, 0);
      box-shadow: 0 3px 8px rgb(0 0 0 / 20%);
    }

    img {
      width: 306px;
      height: 306px;
    }

    p {
      font-size: 22px;
      padding-top: 12px;
      text-align: center;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    .price {
      color: $priceColor;
    }
  }
}
</style>
```

### 2. 封装接口

```javascript
/**
 * @description: 获取新鲜好物
 * @param {*}
 * @return {*}
 */
export const findNewAPI = () => {
  return httpInstance({
    url:'/home/new'
  })
}
```

### 3. 获取数据渲染模版 

```vue
<script setup>
import HomePanel from './HomePanel.vue'
import { getNewAPI } from '@/apis/home'
import { ref } from 'vue'
const newList = ref([])
const getNewList = async () => {
  const res = await getNewAPI()
  newList.value = res.result
}

getNewList()
</script>

<template>
  <HomePanel title="新鲜好物" sub-title="新鲜出炉 品质靠谱">
    <template #main>
      <ul class="goods-list">
        <li v-for="item in newList" :key="item.id">
          <RouterLink :to="`/detail/${item.id}`">
            <img :src="item.picture" alt="" />
            <p class="name">{{ item.name }}</p>
            <p class="price">&yen;{{ item.price }}</p>
          </RouterLink>
        </li>
      </ul>
    </template>
  </HomePanel>
</template>
```

## 人气推荐实现

### 1. 封装接口

```javascript
/**
 * @description: 获取人气推荐
 * @param {*}
 * @return {*}
 */
export const getHotAPI = () => {
  return  httpInstance('home/hot', 'get', {})
}
```

### 2. 获取数据渲染模版

```vue
<script setup>
import HomePanel from './HomePanel.vue'
import { getHotAPI } from '@/apis/home'
import { ref } from 'vue'
const hotList = ref([])
const getHotList = async () => {
  const res = await getHotAPI()
  hotList.value = res.result
}
getHotList()

</script>

<template>
  <HomePanel title="人气推荐" sub-title="人气爆款 不容错过">
      <ul class="goods-list">
        <li v-for="item in hotList" :key="item.id">
          <RouterLink to="/">
            <img v-img-lazy="item.picture" alt="">
            <p class="name">{{ item.title }}</p>
            <p class="desc">{{ item.alt }}</p>
          </RouterLink>
        </li>
      </ul>
  </HomePanel>
</template>

<style scoped lang='scss'>
.goods-list {
  display: flex;
  justify-content: space-between;
  height: 426px;

  li {
    width: 306px;
    height: 406px;
    transition: all .5s;

    &:hover {
      transform: translate3d(0, -3px, 0);
      box-shadow: 0 3px 8px rgb(0 0 0 / 20%);
    }

    img {
      width: 306px;
      height: 306px;
    }

    p {
      font-size: 22px;
      padding-top: 12px;
      text-align: center;
    }

    .desc {
      color: #999;
      font-size: 18px;
    }
  }
}
</style>
```



## 图片懒加载实现

### 场景和指令用法

> 场景：电商网站的首页通常会很长，用户不一定能访问到页面靠下面的图片，这类图片通过懒加载优化手段可以做到只有进入视口区域才发送图片请求

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121430071.png" alt="image-20230512143047029" style="zoom:67%;" />

> 在图片img身上绑定指令，该图片只有在正式进入到视口区域时才会发送图片网络请求

### 实现思路和步骤

> 核心原理：图片进入视口才发送资源请求

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121431740.png" alt="image-20230512143130684" style="zoom:67%;" />

### 回顾核心步骤代码

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121431999.png" alt="image-20230512143147927" style="zoom:80%;" />

### 1. 封装全局指令

```javascript
// 定义懒加载插件
import { useIntersectionObserver } from '@vueuse/core'

export const lazyPlugin = {
  install (app) {
    // 懒加载指令逻辑
    app.directive('img-lazy', {
      mounted (el, binding) {
        // el: 指令绑定的那个元素 img
        // binding: binding.value  指令等于号后面绑定的表达式的值  图片url
        console.log(el, binding.value)
        const { stop } = useIntersectionObserver(
          el,
          ([{ isIntersecting }]) => {
            console.log(isIntersecting)
            if (isIntersecting) {
              // 进入视口区域
              el.src = binding.value
              stop()
            }
          },
        )
      }
    })
  }
}
```

### 2. 注册全局指令

```javascript
// 全局指令注册
import { directivePlugin } from '@/directives'
app.use(directivePlugin)
```



## 懒加载指令优化

### 问题1：逻辑书写位置不合理

问：懒加载指令的逻辑直接写到入口文件中，合理吗？

答：不合理，入口文件通常只做一些初始化的事情，不应该包含太多的逻辑代码，可以通过插件的方法把懒加载指令封装为插件，main.js入口文件只需要负责注册插件即可

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121432282.png" alt="image-20230512143218221" style="zoom:80%;" />

### 问题2：重复监听问题

useIntersectionObserver对于元素的监听是一直存在的，除非手动停止监听，存在内存浪费

解决思路：在监听的图片第一次完成加载之后就停止监听

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121432358.png" alt="image-20230512143244306" style="zoom:67%;" />

## 产品列表实现

Product产品列表是一个常规的列表渲染，实现步骤如下：

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121433428.png" alt="image-20230512143309383" style="zoom:80%;" />

### 1. 基础数据渲染

1- 准备静态模版

```vue
<script setup>
import HomePanel from './HomePanel.vue'

</script>

<template>
  <div class="home-product">
    <!-- <HomePanel :title="cate.name" v-for="cate in goodsProduct" :key="cate.id">
      <div class="box">
        <RouterLink class="cover" to="/">
          <img :src="cate.picture" />
          <strong class="label">
            <span>{{ cate.name }}馆</span>
            <span>{{ cate.saleInfo }}</span>
          </strong>
        </RouterLink>
        <ul class="goods-list">
          <li v-for="good in cate.goods" :key="good.id">
            <RouterLink to="/" class="goods-item">
              <img :src="good.picture" alt="" />
              <p class="name ellipsis">{{ good.name }}</p>
              <p class="desc ellipsis">{{ good.desc }}</p>
              <p class="price">&yen;{{ good.price }}</p>
            </RouterLink>
          </li>
        </ul>
      </div>
    </HomePanel> -->
  </div>
</template>

<style scoped lang='scss'>
.home-product {
  background: #fff;
  margin-top: 20px;
  .sub {
    margin-bottom: 2px;

    a {
      padding: 2px 12px;
      font-size: 16px;
      border-radius: 4px;

      &:hover {
        background: $xtxColor;
        color: #fff;
      }

      &:last-child {
        margin-right: 80px;
      }
    }
  }

  .box {
    display: flex;

    .cover {
      width: 240px;
      height: 610px;
      margin-right: 10px;
      position: relative;

      img {
        width: 100%;
        height: 100%;
      }

      .label {
        width: 188px;
        height: 66px;
        display: flex;
        font-size: 18px;
        color: #fff;
        line-height: 66px;
        font-weight: normal;
        position: absolute;
        left: 0;
        top: 50%;
        transform: translate3d(0, -50%, 0);

        span {
          text-align: center;

          &:first-child {
            width: 76px;
            background: rgba(0, 0, 0, 0.9);
          }

          &:last-child {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
          }
        }
      }
    }

    .goods-list {
      width: 990px;
      display: flex;
      flex-wrap: wrap;

      li {
        width: 240px;
        height: 300px;
        margin-right: 10px;
        margin-bottom: 10px;

        &:nth-last-child(-n + 4) {
          margin-bottom: 0;
        }

        &:nth-child(4n) {
          margin-right: 0;
        }
      }
    }

    .goods-item {
      display: block;
      width: 220px;
      padding: 20px 30px;
      text-align: center;
      transition: all .5s;

      &:hover {
        transform: translate3d(0, -3px, 0);
        box-shadow: 0 3px 8px rgb(0 0 0 / 20%);
      }

      img {
        width: 160px;
        height: 160px;
      }

      p {
        padding-top: 10px;
      }

      .name {
        font-size: 16px;
      }

      .desc {
        color: #999;
        height: 29px;
      }

      .price {
        color: $priceColor;
        font-size: 20px;
      }
    }
  }
}
</style>
```

2- 封装接口

```javascript
/**
 * @description: 获取所有商品模块
 * @param {*}
 * @return {*}
 */
export const getGoodsAPI = () => {
  return httpInstance({
    url: '/home/goods'
  })
}
```

3- 获取并渲染数据

```vue
<script setup>
import HomePanel from './HomePanel.vue'
import { getGoodsAPI } from '@/apis/home'
import { ref } from 'vue'
const goodsProduct = ref([])
const getGoods = async () => {
  const { result } = await getGoodsAPI()
  goodsProduct.value = result
}
onMounted( ()=> getGoods() )
</script>

<template>
  <div class="home-product">
    <HomePanel :title="cate.name" v-for="cate in goodsProduct" :key="cate.id">
      <div class="box">
        <RouterLink class="cover" to="/">
          <img :src="cate.picture" />
          <strong class="label">
            <span>{{ cate.name }}馆</span>
            <span>{{ cate.saleInfo }}</span>
          </strong>
        </RouterLink>
        <ul class="goods-list">
          <li v-for="goods in cate.goods" :key="good.id">
            <RouterLink to="/" class="goods-item">
              <img :src="goods.picture" alt="" />
              <p class="name ellipsis">{{ goods.name }}</p>
              <p class="desc ellipsis">{{ goods.desc }}</p>
              <p class="price">&yen;{{ goods.price }}</p>
            </RouterLink>
          </li>
        </ul>
      </div>
    </HomePanel>
  </div>
</template>
```

### 2. 图片懒加载

```html
<div class="home-product">
  <HomePanel :title="cate.name" v-for="cate in goodsProduct" :key="cate.id">
    <div class="box">
      <RouterLink class="cover" to="/">
        <!-- 指令替换 -->
        <img v-img-lazy="cate.picture" />
      </RouterLink>
      <ul class="goods-list">
        <li v-for="goods in cate.goods" :key="goods.id">
          <RouterLink to="/" class="goods-item">
             <!-- 指令替换 -->
            <img v-img-lazy="goods.picture" alt="" />
          </RouterLink>
        </li>
      </ul>
    </div>
  </HomePanel>
</div>
```



## 商品组件封装

### 为什么要封装

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121433651.png" alt="image-20230512143336593" style="zoom:80%;" />

> 在小兔鲜项目的很多个业务模块中都需要用到同样的商品展示模块，没必要重复定义，封装起来，方便复用

### 如何封装

> 核心思想：把要显示的数据对象设计为props参数，传入什么数据对象就显示什么数据

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121434444.png" alt="image-20230512143406369" style="zoom:80%;" />

> GoodsItem属于纯展示类组件，这类组件的封装思路是什么？抽象Props参数，传入什么就显示什么

### 1. 封装组件

```vue
<script setup>
defineProps({
  goods: {
    type: Object,
    default: () => { }
  }
})
</script>

<template>
  <RouterLink to="/" class="goods-item">
    <img :src="goods.picture" alt="" />
    <p class="name ellipsis">{{ goods.name }}</p>
    <p class="desc ellipsis">{{ goods.desc }}</p>
    <p class="price">&yen;{{ goods.price }}</p>
  </RouterLink>
</template>


<style scoped lang="scss">
.goods-item {
  display: block;
  width: 220px;
  padding: 20px 30px;
  text-align: center;
  transition: all .5s;

  &:hover {
    transform: translate3d(0, -3px, 0);
    box-shadow: 0 3px 8px rgb(0 0 0 / 20%);
  }

  img {
    width: 160px;
    height: 160px;
  }

  p {
    padding-top: 10px;
  }

  .name {
    font-size: 16px;
  }

  .desc {
    color: #999;
    height: 29px;
  }

  .price {
    color: $priceColor;
    font-size: 20px;
  }
}
</style>
```

### 2. 使用组件

```vue
<ul class="goods-list">
  <li v-for="goods in cate.goods" :key="item.id">
    <GoodsItem :goods="goods" />
  </li>
</ul>
```



# 一级分类

## 整体认识和路由配置

### 路由配置

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121434290.png" alt="image-20230512143452241" style="zoom:80%;" />

### 1. 准备分类组件

```vue
<script setup>

</script>

<template>
  <div class='top-category'>
    我是分类
  </div>
</template>
```

### 2. 配置路由

```javascript
import { createRouter, createWebHashHistory } from 'vue-router'
import Layout from '@/views/Layout/index.vue'
import Home from '@/views/Home/index.vue'
import Category from '@/views/Category/index.vue'
const router = createRouter({
  history: createWebHashHistory(import.meta.env.BASE_URL),
  routes: [
    {
      path: '/',
      name: 'layout',
      component: Layout,
      children: [
        {
          path: '',
          name: 'home',
          component: Home
        },
        {
          path: 'category/:id',
          name: 'category',
          component: Category
        }
      ]
    },
    {
      path: '/login',
      name: 'login',
      component: Login
    },

  ]
})

export default router
```

### 3. 配置导航区域链接

```html
<li v-for="item in categoryStore.categoryList" :key="item.id">
  <RouterLink active-class="active" :to="`/category/${item.id}`">
    {{ item.name }}
  </RouterLink>
</li>
```



## 面包屑导航渲染

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121435307.png" alt="image-20230512143508255" style="zoom:80%;" />

### 1. 认识组件准备模版

```vue
<script setup>

</script>

<template>
  <div class="top-category">
    <div class="container m-top-20">
      <!-- 面包屑 -->
      <div class="bread-container">
        <el-breadcrumb separator=">">
          <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
          <el-breadcrumb-item>居家</el-breadcrumb-item>
        </el-breadcrumb>
      </div>
    </div>
  </div>
</template>


<style scoped lang="scss">
.top-category {
  h3 {
    font-size: 28px;
    color: #666;
    font-weight: normal;
    text-align: center;
    line-height: 100px;
  }

  .sub-list {
    margin-top: 20px;
    background-color: #fff;

    ul {
      display: flex;
      padding: 0 32px;
      flex-wrap: wrap;

      li {
        width: 168px;
        height: 160px;


        a {
          text-align: center;
          display: block;
          font-size: 16px;

          img {
            width: 100px;
            height: 100px;
          }

          p {
            line-height: 40px;
          }

          &:hover {
            color: $xtxColor;
          }
        }
      }
    }
  }

  .ref-goods {
    background-color: #fff;
    margin-top: 20px;
    position: relative;

    .head {
      .xtx-more {
        position: absolute;
        top: 20px;
        right: 20px;
      }

      .tag {
        text-align: center;
        color: #999;
        font-size: 20px;
        position: relative;
        top: -20px;
      }
    }

    .body {
      display: flex;
      justify-content: space-around;
      padding: 0 40px 30px;
    }
  }

  .bread-container {
    padding: 25px 0;
  }
}
</style>
```

### 2. 封装接口

```javascript
import request from '@/utils/request'

/**
 * @description: 获取分类数据
 * @param {*} id 分类id 
 * @return {*}
 */
export const getTopCategoryAPI = (id) => {
  return request({
    url:'/category',
    params:{
      id
    }
  })
}
```

### 3. 渲染面包屑导航

```vue
<script setup>
  import { findTopCategoryAPI } from '@/apis/category'
  const categoryData = ref({})
  const route = useRoute()
  const getCategory = async (id) => {
    // 如何在setup中获取路由参数 useRoute() -> route 等价于this.$route
    const res = await findTopCategoryAPI(id)
    categoryData.value = res.result
  }
  getCategory(route.params.id)
</script>


<template>
  <div class="bread-container">
    <el-breadcrumb separator=">">
      <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
      <el-breadcrumb-item>{{ categoryData.name }}</el-breadcrumb-item>
    </el-breadcrumb>
  </div>
</template>
```



## banner轮播图实现

> 分类轮播图和首页轮播图的区别只有一个，接口参数不同，其余逻辑完成一致

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121435306.png" alt="image-20230512143533242" style="zoom:80%;" />



### 1. 适配接口

```javascript
export function getBannerAPI (params = {}) {
  // 默认为1 商品为2
  const { distributionSite = '1' } = params
  return httpInstance({
    url: '/home/banner',
    params: {
      distributionSite
    }
  })
}
```

### 2. 迁移首页Banner逻辑

```vue
<script setup>
// 部分代码省略
import { getBannerAPI } from '@/apis/home'

// 获取banner
const bannerList = ref([])

const getBanner = async () => {
  const res = await getBannerAPI({
    distributionSite: '2'
  })
  console.log(res)
  bannerList.value = res.result
}

onMounted(() => getBanner())

</script>

<template>
  <div class="top-category">
    <div class="container m-top-20">
      <!-- 面包屑 -->
      <div class="bread-container">
        <el-breadcrumb separator=">">
          <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
          <el-breadcrumb-item>{{ categoryData.name }}</el-breadcrumb-item>
        </el-breadcrumb>
      </div>
      <!-- 轮播图 -->
      <div class="home-banner">
        <el-carousel height="500px">
          <el-carousel-item v-for="item in bannerList" :key="item.id">
            <img :src="item.imgUrl" alt="">
          </el-carousel-item>
        </el-carousel>
      </div>
    </div>
  </div>
</template>


<style scoped lang="scss">
// 部分代码省略
.home-banner {
  width: 1240px;
  height: 500px;
  margin: 0 auto;
  img {
    width: 100%;
    height: 500px;
  }
}
</style>
```



## 激活状态显示和分类列表渲染

### 激活状态显示

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121436030.png" alt="image-20230512143618980" style="zoom:80%;" />

> RouterLink组件默认支持激活样式显示的类名，只需要给active-class属性设置对应的类名即可

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121436740.png" alt="image-20230512143635679" style="zoom:80%;" />

### 分类列表渲染

> 分类的数据已经在面包屑导航实现的时候获取到了，只需要通过v-for遍历出来即可

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121437279.png" alt="image-20230512143702233" style="zoom:67%;" />

### 1. 导航激活状态设置

```vue
<RouterLink active-class="active" :to="`/category/${item.id}`">{{ item.name }}</RouterLink>
```

### 2. 分类数据模版

```html
<div class="sub-list">
  <h3>全部分类</h3>
  <ul>
    <li v-for="i in categoryData.children" :key="i.id">
      <RouterLink to="/">
        <img :src="i.picture" />
        <p>{{ i.name }}</p>
      </RouterLink>
    </li>
  </ul>
</div>
<div class="ref-goods" v-for="item in categoryData.children" :key="item.id">
  <div class="head">
    <h3>- {{ item.name }}-</h3>
  </div>
  <div class="body">
    <GoodsItem v-for="good in item.goods" :goods="good" :key="good.id" />
  </div>
</div>
```



## 解决路由缓存问题

> 1. 路由缓存问题产生的原因是什么？路由只有参数变化时，会复用组件实例
>
> 2. 俩种方案都可以解决路由缓存问题，如何选择呢？在意性能问题，选择onBeforeUpdate, 精细化控制不在意性能问题，选择key，简单粗暴

### 什么是路由缓存问题

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121437660.png" alt="image-20230512143734577" style="zoom:80%;" />

### 给router-view添加key

以当前路由完整路径为key的值，给router-view组件绑定

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121438492.png" alt="image-20230512143802431" style="zoom: 67%;" />

### 使用beforeRouteUpdate导航钩子

> beforeRouteUpdate钩子函数可以在每次路由更新之前执行，在回调中执行需要数据更新的业务逻辑即可

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121438155.png" alt="image-20230512143827085" style="zoom:80%;" />

## 使用逻辑函数拆分业务

### 概念理解

> 基于逻辑函数拆分业务是指把同一个组件中独立的业务代码通过函数做封装处理，提升代码的可维护性

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121439887.png" alt="image-20230512143919837" style="zoom:67%;" />

### 具体怎么做

> 1. 按照业务声明以 `use` 打头的逻辑函数
>
> 2. 把独立的业务逻辑封装到各个函数内部
>
> 3. 函数内部把组件中需要用到的数据或者方法return出去
> 4. 在组件中调用函数把数据或者方法组合回来使用

### 核心思想总结

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121441268.png" alt="image-20230512144149203" style="zoom:67%;" />

```javascript
// 封装分类数据业务相关代码
import { onMounted, ref } from 'vue'
import { getCategoryAPI } from '@/apis/category'
import { useRoute } from 'vue-router'
import { onBeforeRouteUpdate } from 'vue-router'

export function useCategory () {
  // 获取分类数据
  const categoryData = ref({})
  const route = useRoute()
  const getCategory = async (id = route.params.id) => {
    const res = await getCategoryAPI(id)
    categoryData.value = res.result
  }
  onMounted(() => getCategory())

  // 目标:路由参数变化的时候 可以把分类数据接口重新发送
  onBeforeRouteUpdate((to) => {
    // 存在问题：使用最新的路由参数请求最新的分类数据
    getCategory(to.params.id)
  })
  return {
    categoryData
  }
}
```

```javascript
// 封装banner轮播图相关的业务代码
import { ref, onMounted } from 'vue'
import { getBannerAPI } from '@/apis/home'

export function useBanner () {
  const bannerList = ref([])

  const getBanner = async () => {
    const res = await getBannerAPI({
      distributionSite: '2'
    })
    console.log(res)
    bannerList.value = res.result
  }

  onMounted(() => getBanner())

  return {
    bannerList
  }
}
```

```vue
<script setup>

import GoodsItem from '../Home/components/GoodsItem.vue'
import { useBanner } from './composables/useBanner'
import { useCategory } from './composables/useCategory'
const { bannerList } = useBanner()
const { categoryData } = useCategory()

</script>
```

# 二级分类

## 功能描述

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121443333.png" alt="image-20230512144335237" style="zoom:80%;" />

### 配置二级路由

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121445881.png" alt="image-20230512144528809" style="zoom:67%;" />

## 面包屑导航实现

### 实现步骤

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121445543.png" alt="image-20230512144551487" style="zoom:67%;" />

## 商品列表实现

### 整体流程梳理

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121446589.png" alt="image-20230512144615497" style="zoom:67%;" />

### 基础参数获取基础列表

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121446046.png" alt="image-20230512144632977" style="zoom:67%;" />

### 添加筛选参数实现筛选功能

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121446775.png" alt="image-20230512144653690" style="zoom:67%;" />

### 列表无限加载功能实现

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121448370.png" alt="image-20230512144822289" style="zoom:80%;" />

## 定制路由scrollBehavior

### 定制路由行为解决什么问题

> 在不同路由切换的时候，可以自动滚动到页面的顶部，而不是停留在原先的位置.如何配置：vue-router支持 scrollBehavior 配置项，可以指定路由切换时的滚动位置

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121449849.png" alt="image-20230512144903798" style="zoom:67%;" />

# 详情页

## 整体业务认识

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121449374.png" alt="image-20230512144930288" style="zoom:80%;" />



## 路由配置

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121449956.png" alt="image-20230512144945869" style="zoom:67%;" />

## 基础数据渲染

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121450968.png" alt="image-20230512145003883" style="zoom:80%;" />

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121450493.png" alt="image-20230512145013445" style="zoom:80%;" />

> 渲染模版时遇到对象的多层属性访问可能出现什么问题？

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121450079.png" alt="image-20230512145035021" style="zoom:67%;" />

## 热榜区域实现

### 模块实现整体分析

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121451303.png" alt="image-20230512145102226" style="zoom:80%;" />



## 图片预览组件封装

### 组件功能分析

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121452243.png" alt="image-20230512145216106" style="zoom:80%;" />

### 通过小图切换大图实现

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121452297.png" alt="image-20230512145239201" style="zoom:80%;" />

### 放大镜效果实现

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121453967.png" alt="image-20230512145325868" style="zoom:67%;" />

功能拆解

> 1. 左侧滑块跟随鼠标移动
>
> 2. 右侧大图放大效果实现
>
> 3. 鼠标移入控制滑块和大图显示隐藏

### 滑块跟随鼠标移动

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121454781.png" alt="image-20230512145402667" style="zoom:80%;" />

### 大图效果实现

> 效果：为实现放大效果，大图的宽高是小图的俩倍
>
> 思路：大图的移动方向和滑块移动方向相反，且数值为2倍

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121454109.png" alt="image-20230512145422014" style="zoom:67%;" />

### 鼠标移入控制显隐

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121454487.png" alt="image-20230512145458386" style="zoom:80%;" />

### 组件props适配

组件中的图片列表不能写死，需要通过props参数把接口数据传入

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121455716.png" alt="image-20230512145517658" style="zoom:67%;" />





<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121455429.png" alt="image-20230512145529361" style="zoom:80%;" />



## SKU组件

### SKU概念

> 存货单位（英语：stock keeping unit，SKU/ˌɛsˌkeɪˈjuː/），也翻译为库存单元，是一个会计学名词，定义为库存管理中的最小可用单元，例如纺织品中一个SKU通常表示规格、颜色、款式，而在连锁零售门店中有时称单品为一个SKU,  SKU组件的作用：产出当前用户选择的商品规格，为加入购物车操作提供数据信息

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121457556.png" alt="image-20230512145705504" style="zoom:80%;" />

### SKU组件使用

> 问：在实际工作中，经常会遇到别人写好的组件，熟悉一个三方组件，首先重点看什么？
>
> 答：props和emit，props决定了当前组件接收什么数据，emit决定了会产出什么数据

验证组件是否成功使用：

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121457795.png" alt="image-20230512145730739" style="zoom:80%;" />

## 通用组件统一注册全局

### 为什么要优化

> 背景：components目录下有可能还会有很多其他通用型组件，有可能在多个业务模块中共享，所有统一进行全局组件注册比较好

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121458602.png" alt="image-20230512145807539" style="zoom:67%;" />

# 登录

## 整体认识和路由配置

### 整体认识

登录页面的主要功能就是表单校验和登录登出业务

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121500604.png" alt="image-20230512150054498" style="zoom:67%;" />

## 表单校验实现

### 为什么需要校验

作用：前端提前校验可以省去一些错误的请求提交，为后端节省接口压力

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121501964.png" alt="image-20230512150133906" style="zoom:80%;" />

### 表单如何进行校验

ElementPlus表单组件内置了表单校验功能，只需要按照组件要求配置必要参数即可（直接看文档）

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121501484.png" alt="image-20230512150153431" style="zoom:67%;" />

思想：当功能很复杂时，通过多个组件各自负责某个小功能，再组合成一个大功能是组件设计中的常用方法

### 表单校验步骤

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121502785.png" alt="image-20230512150220718" style="zoom:67%;" />

### 自定义校验规则

> ElementPlus表单组件内置了初始的校验配置，应付简单的校验只需要通过配置即可，如果想要定制一些特殊的校验需求，可以使用自定义校验规则，格式如下：

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121502320.png" alt="image-20230512150242254" style="zoom:67%;" />

校验逻辑：如果勾选了协议框，通过校验，如果没有勾选，不通过校验

### 整个表单的内容验证

> 思考：每个表单域都有自己的校验触发事件，如果用户一上来就点击登录怎么办呢？
>
> 答：在点击登录时需要对所有需要校验的表单进行统一校验

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121503774.png" alt="image-20230512150320714" style="zoom:80%;" />

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121503948.png" alt="image-20230512150329906" style="zoom:80%;" />



## 基础登录业务实现

### 登录业务流程

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121505853.png" alt="image-20230512150546794" style="zoom:67%;" />

## Pinia管理用户数据

### 为什么要用Pinia管理数据

由于用户数据的特殊性，在很多组件中都有可能进行共享，共享的数据使用Pinia管理会更加方便

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121506883.png" alt="image-20230512150617818" style="zoom:67%;" />

### 如何使用Pinia管理数据

遵循理念：和数据相关的所有操作（state + action）都放到Pinia中，组件只负责触发action函数

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121506958.png" alt="image-20230512150636909" style="zoom:67%;" />

### 关键代码

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121507224.png" alt="image-20230512150701140" style="zoom:80%;" />

## Pinia用户数据持久化

### 持久化用户数据说明

> 1. 用户数据中有一个关键的数据叫做Token （用来标识当前用户是否登录），而Token持续一段时间才会过期
>
> 2. Pinia的存储是基于内存的，刷新就丢失，为了保持登录状态就要做到刷新不丢失，需要配合持久化进行存储

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121507488.png" alt="image-20230512150752405" style="zoom:80%;" />

### 关键步骤总结和插件运行机制

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121508391.png" alt="image-20230512150817317" style="zoom:67%;" />

> 运行机制：在设置state的时候会自动把数据同步给localStorage，在获取state数据的时候会优先从localStorage中取

## 登录和非登录状态的模版适配

### 需求理解

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121508870.png" alt="image-20230512150853806" style="zoom:67%;" />

### 多模版适配的通用思路

> 思路：有几个需要适配的模版就准备几个template片段，通过条件渲染控制显示即可

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121509324.png" alt="image-20230512150911257" style="zoom:80%;" />

## 请求拦截器携带Token

### 为什么要在请求拦截器携带Token

> Token作为用户标识，在很多个接口中都需要携带Token才可以正确获取数据，所以需要在接口调用时携带Token。另外，为了统一控制采取请求拦截器携带的方案

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121509897.png" alt="image-20230512150943839" style="zoom:67%;" />

### 如何配置

> Axios请求拦截器可以在接口正式发起之前对请求参数做一些事情，通常Token数据会被注入到请求header中，格式按照后端要求的格式进行拼接处理

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121510229.png" alt="image-20230512151029146" style="zoom:67%;" />

### 退出登录功能实现

<img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.3.30/202305121510134.png" alt="image-20230512151048062" style="zoom:80%;" />



